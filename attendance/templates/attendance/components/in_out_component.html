{% load horillafilters attendancefilters i18n %}
{% if request.user.employee_get %}
    {% with get_forecasted_at_work=request.user.employee_get.get_forecasted_at_work %}
        {% if request.session.selected_company == "all" or request.user.employee_get.employee_work_info.company_id.id == request.session.selected_company|default:"-1"|add:"0" %}
            <!-- "CHEKING WETHER Check in/check out enabled" -->
            {% if request|is_check_in_enabled %}
                <!-- "CHEKING WETHER ITS IS THE CURRENT EMPLOYEES COMPANY OR ALL COMPANY, THEN ONLY SHOWS THE CHECK-IN, CHECK-OUT BUTTON" -->
                {% if request.user|is_clocked_in and get_forecasted_at_work.has_attendance %}
                    <button class="oh-btn oh-btn--warning-outline mr-2" {% if enabled_timerunner and get_forecasted_at_work.has_attendance %} onmouseenter="$(this).find('span').show();$(this).find('.time-runner').hide();" onmouseleave="$(this).find('span').hide();$(this).find('.time-runner').show();" {% endif %} hx-get="{% url 'clock-out' %}"  hx-target='#attendance-activity-container' hx-swap='innerHTML'><ion-icon class="oh-navbar__clock-icon mr-2 text-warning" name="exit-outline"></ion-icon>
                        <span class="hr-Check-In-out-text" {% if enabled_timerunner and get_forecasted_at_work.has_attendance %} style="display: none;" {% endif %}>{% trans "Check-Out" %}</span>
                        {% if get_forecasted_at_work.has_attendance %}
                        <div class="time-runner"></div>
                        {% endif %}
                    </button>
                    <a href="{% url 'face-attendance-interface' %}" class="oh-btn oh-btn--info-outline mr-2" title="{% trans 'Face Recognition Attendance' %}">
                        <ion-icon class="oh-navbar__clock-icon mr-2 text-info" name="scan-outline"></ion-icon>
                        <span class="hr-Check-In-out-text">{% trans "Face Recognition" %}</span>
                    </a>
                    <script>
                        run = 1
                    </script>
                {% else %}
                    <!-- Check if face detection is enabled for the company -->
                    {% if request.user.employee_get.get_company.face_detection.start %}
                        <!-- Face Recognition Check-In Button -->
                        <a href="{% url 'face-attendance-interface' %}?action=checkin" class="oh-btn oh-btn--success-outline mr-2" title="{% trans 'Check-In with Face Recognition' %}">
                            <ion-icon class="oh-navbar__clock-icon mr-2 text-success" name="enter-outline"></ion-icon>
                            <span class="hr-Check-In-out-text">{% trans "Check-In" %}</span>
                        </a>
                        <!-- Alternative: Direct Check-In Button (fallback) -->
                        <!--
                        <button {% if enabled_timerunner %} onmouseenter="$(this).find('span').show();$(this).find('.at-work-seconds').hide();" onmouseleave="$(this).find('span').hide();$(this).find('.at-work-seconds').show();" {% endif %}
                            class="oh-btn oh-btn--secondary-outline mr-2" hx-get="{% url 'clock-in' %}"  hx-target='#attendance-activity-container' hx-swap='innerHTML'
                            title="{% trans 'Direct Check-In (without face recognition)' %}">
                                <ion-icon class="oh-navbar__clock-icon mr-2 text-secondary" name="enter-outline"></ion-icon>
                            <span class="hr-Check-In-out-text" {% if enabled_timerunner %} style="display: none;" {% endif %}>{% trans "Direct Check-In" %}</span>
                            <div class="at-work-seconds"></div>
                        </button>
                        -->
                    {% else %}
                        <!-- Traditional Check-In Button (when face detection is disabled) -->
                        <button {% if enabled_timerunner %} onmouseenter="$(this).find('span').show();$(this).find('.at-work-seconds').hide();" onmouseleave="$(this).find('span').hide();$(this).find('.at-work-seconds').show();" {% endif %}
                            class="oh-btn oh-btn--success-outline mr-2" hx-get="{% url 'clock-in' %}"  hx-target='#attendance-activity-container' hx-swap='innerHTML'
                            >
                                <ion-icon class="oh-navbar__clock-icon mr-2 text-success" name="enter-outline"></ion-icon>
                            <span class="hr-Check-In-out-text" {% if enabled_timerunner %} style="display: none;" {% endif %}>{% trans "Check-In" %}</span>
                            <div class="at-work-seconds"></div>
                        </button>
                    {% endif %}
                    {% if enabled_timerunner %}
                        <script>
                            $(document).ready(function () {
                                $('.at-work-seconds').html(secondsToDuration({{get_forecasted_at_work.forecasted_at_work_seconds}}));
                            });
                            run = 0;
                        </script>
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endwith %}
{% endif %}
